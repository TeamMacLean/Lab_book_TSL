23/02/15
===

[Synteny-based mapping-by-sequencing enabled by targeted enrichment](http://onlinelibrary.wiley.com/doi/10.1111/j.1365-313X.2012.04993.x/full)

[Reads from ShoreMap](http://1001genomes.org/software/shoremap.html)

Reads fastq.gz into galaxy (fastqillumina)


24/02/15
===

Run BWA with reads (change format to fastqillumina) using TAIR10 as a reference genome. Obtain SAM files that need to be converted to BAM and then we can do BAM merge in order to have all the reads together. 

Eventually learn how to do this in the cluster because of the space needed. Write a bash script based on the information provided by the tools (BWA, etc)

```
bsub –q TSL-Test128 –We 10 “source bwa-0.7.4; bwa mem -t 4
-c 5000 -O 5 -P -B 5 -U 10 ref.fa left.fq right.fq > map.sam”
```

First attempt doesn't work. VCF file is empty. I'll try tomorrow in the command line.

25/02/15
===
Try to download reads in cluster from BCF2 from [SHOREmap v3.0](http://bioinfo.mpipz.mpg.de/shoremap/SHOREmap_v3.0.html):

_The second study included sequencing of the mutants of a recombinant backcross population. These were generated by backcrossing a mutant to the non-mutagenized progenitor followed by one round of inbreeding. A mutant pool of 110 individuals was sequenced with Illumina paired-end reads at 50x sequencing depth (called **BCF2** in the following)._

Don't know why but I cannot expand one of the files in the cluster.

In the meantime, use at the same time reads from single-end experiment from [Scheneeberger 2009](http://1001genomes.org/software/shoremap.html) in the cluster (only had time for s_3_sequence) and in the galaxy browser. In the browser, use BWA v0.7.5 with the reference genome TAIR10 from the SHOREmap v3.0 above. After BWA, convert SAM-to-BAM, then merge the BAM files obtained for all the reads and run MPileup and VarScan to obtain the VCF file with the SNPs. For the cluster, run sh script called bwa.sh

```
source bwa-0.7.4

bsub -q TSL-Test128 -o sam.txt "bwa index TAIR10_chr_all.fas"
bsub -q TSL-Test128 -o sam.txt "bwa mem TAIR10_chr_all.fas /Schneeberger/s_3_sequence.fq > map.sam2"
bsub -q TSL-Test128 -o sam.txt "bwa aln TAIR10_chr_all.fas /Schneeberger/s_3_sequence.fq > aln_sa.sai"
bsub -q TSL-Test128 -o sam.txt "bwa samse TAIR10_chr_all.fas aln_sa.sai /Schneeberger/s_3_sequence.fq > aln-se.sam"

```

My idea is to use this VCF file as the starting point for SDM with a fake fasta file, but don't know if it'll be possible because the SNPs are defined per chromosome and not per fragment as in the model.

27/02/15
===

The VCF file obtained from Galaxy have a very low number of hm SNPs so I don't think it is going to be useful for SDM. Maybe I need to change the parameters to be less restrictive when looking for SNPs. Good example anyway to start playing. I am writing a script (manage_vcf.rb) to classify the SNPs per type and create arrays with all the positions. It divides the original file in 5 different vcf files (one for each chromosome). Then, I create .txt files with the positions of the hm and ht SNPs. 

When merging BAM files obtain: 

```
[bam_header_read] EOF marker is absent. The input is probably truncated.
```
Apparently this is ok, and it should work, so I move forward and create the mpileup file with samtools. [Change to latest version of samtools for next time, currently using 0.1.17]

